{% extends "layout.html" %}
{% block title %}
My Plants
{% endblock %}
{% block content %}
<!-- Header for Seed Plant page -->
<div class="seedPlantHeader">
    <div class="addItemButton">
        <button class="button addButton" onclick="openAddPlantPopup()">Add Plant</button>
    </div>
    <div class="removeItemButton">
        <button class="button removeButton">Remove Plant</button>
    </div>
    <div class="refineItemButton">
        <button class="button refineButton">Refine Options</button>
    </div>
    <div class="searchBar">
        <input type="text" placeholder="Search..">
    </div>
</div>

<!-- Basic Info Button and Checkbox -->
<div class="BasicInfo">
    <button class="InfoButton" onclick="openPlantPopup()">
        <div class="infoDetails">
            <p>Plant Name</p>
        </div>
        <div class="infoDetails">
            <p>Type of Plant</p>
        </div>
        <div class="infoDetails">
            <p>Where it was Planted</p>
        </div>
    </button>
    <label class="containerInfo">
        <input type="checkbox">
        <span class="checkmark"></span>
    </label>
</div>

<!-- Plant Information Popup -->
<div class="plantPopup" id="plantPopup">
    <h2>Plant Name</h2>
    <div class="infoContainerPlant">
        <div class="infoBackground"><p>Plant date, either from seed or seedling</p></div>
        <div class="infoBackground"><p>Germination Date, newSeedling in db 0 for false, 1 for true, only show germination if newSeedling is false.</p></div>
        <div class="infoBackground"><p>Plant Maturity</p></div>
        <div class="infoBackground"><p>Type of Plant</p></div>
        <div class="infoBackground"><p>Sun Requirement</p></div>
        <div class="infoBackground"><p>What it has been Planted in</p></div>
        <button class="seedExit" onclick="closePlantPopup('plantPopup')">Remove</button>
        <button class="seedExit" onclick="closePlantPopup('plantPopup')">Exit</button>
    </div>
</div>

<!-- Add Plant Popup -->
<div class="addPlantPopup" id="addPlantPopup">
    <div class="tabPopup" onclick="showTab('seedLibraryTab')">From Seed Library</div>
    <div class="tabPopup" onclick="showTab('seedlingTab')">New Seedling</div>
    <div id="seedLibraryTab" class="tabPopup-content activeTab">
        <div class="seedLibraryTabLayout">
            <form id="addPlantSeed">
                <select id="newPlantType">
                    <option value="" disabled selected hidden>Type of Plant</option>
                    {% for seed in user_seeds %}
                        <option value="{{ seed.plant_type }}">{{ seed.plant_type }}</option>
                    {% endfor %}
                </select>
                <select id="newPlantName">
                    <option value="" disabled selected hidden>Seed Name</option>
                    <!-- this area is populated by js -->
                </select>
                <input type="date" id="datePlanted">
                <select id="seedlingPlantPlace" name="seedlingPlantPlace">
                    <option value="" disabled selected hidden>Plant Placement</option>
                    <option value="seedlingTray">Seedling Tray</option>
                    <option value="smallPot">Small Pot</option>
                    <option value="largePot">Large Pot</option>
                    <option value="raisedBed">Raised Bed</option>
                    <option value="garden">Garden</option>
                </select>
                <input type="hidden" id="germinateTime" name="germinateTime">
                <input type="hidden" id="maturityTime" name="maturityTime">
                <button class="newPlantButton" onclick="closeAddPlantPopup('addPlantPopup')">Submit</button>
            </form>
            <button class="newPlantButton" onclick="closeAddPlantPopup('addPlantPopup')">Exit</button>
        </div>
    </div>
    <div id="seedlingTab" class="tabPopup-content">
        <form id="addPlantSeedling" action="/add_plant" method="post" onsubmit="submitForm(); return false;">
            <input type="text" id="seedlingPlantName" placeholder="Enter Plant Name" required>
            <input type="text" id="seedlingPlantType" placeholder="Type of Plant" required>
            <input type="date" id="seedlingPlantDate" placeholder="Plant Date" required>
            <input type="text" id="plantMaturityTime" placeholder="How long for plant Maturity" required>
            <select id="seedlingSunRequirement" name="seedlingSunRequirement">
                <option value="" disabled selected hidden>Sun Requirement</option>
                <option value="fullSun">Full Sun</option>
                <option value="partSun">Part Sun</option>
                <option value="shade">Shade</option>
            </select>
            <select id="seedlingPlantPlace" name="seedlingPlantPlace">
                <option value="" disabled selected hidden>Plant Placement</option>
                <option value="seedlingTray">Seedling Tray</option>
                <option value="smallPot">Small Pot</option>
                <option value="largePot">Large Pot</option>
                <option value="raisedBed">Raised Bed</option>
                <option value="garden">Garden</option>
            </select>
            <button type="submit" class="newPlantButton">Submit</button>
        </form>
        <button class="newPlantButton" onclick="closeAddPlantPopup('addPlantPopup')">Exit</button>
    </div>
</div>

<script>
    let addPlantPopup = document.getElementById("addPlantPopup")
    function openAddPlantPopup() {
        addPlantPopup.classList.add("open-plantPopup");
    }
    function closeAddPlantPopup() {
        addPlantPopup.classList.remove("open-plantPopup");
    }

    let PlantPopup = document.getElementById("plantPopup")
    function openPlantPopup() {
        PlantPopup.classList.add("open-plantPopup");
    }
    function closePlantPopup() {
        PlantPopup.classList.remove("open-plantPopup");
    }

    function showTab(tabId) {
        // Hide all tabs
        document.querySelectorAll('.tabPopup-content').forEach(tab => {
            tab.classList.remove('activeTab');
        });
        // Show the selected tab
        document.getElementById(tabId).classList.add('activeTab');
    }

    function submitForm() {
        const form = document.getElementById('addPlantSeedling');                   //Gets form element with the id 'addPlantSeedling'
        const formData = new FormData(form);                                        //Creates new FormData object from the form

        const plantName = document.getElementById('seedlingPlantName').value;       //Gets element with id seedlingPlantName
        formData.append('seedlingPlantName', plantName);                             //Appends the Plant Name to the formData
        const plantType = document.getElementById('seedlingPlantType').value;
        formData.append('seedlingPlantType', plantType);
        const plantDate = document.getElementById('seedlingPlantDate').value;
        formData.append('seedlingPlantDate', plantDate);
        const plantMaturity = document.getElementById('plantMaturityTime').value;
        formData.append('plantMaturityTime', plantMaturity);
        const plantSun = document.getElementById('seedlingSunRequirement').value;
        formData.append('seedlingSunRequirement', plantSun);
        const plantPlace = document.getElementById('seedlingPlantPlace').value;
        formData.append('seedlingPlantPlace', plantPlace);

        // Make an AJAX request to submit the form data
        fetch('/add_plant', {
            method: 'POST',                         //Specifies HTTP method as POST
            body: formData                          //Sets request body to the FormData object
        }).then(response => {
            console.log(response);                  //Logs response to the console
        }).catch(error => {
            console.error('Error:', error);         //Logs error message to console if there is an error
        })
    }
</script>
{% endblock %}